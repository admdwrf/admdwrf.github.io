
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="My personal technical website">
      
      
        <link rel="canonical" href="https://admdwrf.github.io/labs/graylog/">
      
      
        <meta name="author" content="Frederic ALIX">
      
      
        <link rel="shortcut icon" href="../../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.8.1">
    
    
      
        <title>Install graylog server - fredalix.tech</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-bfecc7305d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-02c2a4388f.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="orange" data-md-color-accent="red">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="https://admdwrf.github.io" title="fredalix.tech" class="md-logo md-header-nav__button">
            <img src="../../images/logo.png" width="24" height="24">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Labs
                </span>
              
            
            Install graylog server
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../t5500/" title="Labs" class="md-tabs__link md-tabs__link--active">
          Labs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../articles/article/" title="Articles" class="md-tabs__link">
          Articles
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../blog/blog/" title="Blog" class="md-tabs__link">
          Blog
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-logo md-nav__button">
        <img src="../../images/logo.png">
      </i>
    
    fredalix.tech
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Labs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Labs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../t5500/" title="Install FreeBSD on Dell T5000" class="md-nav__link">
      Install FreeBSD on Dell T5000
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ajout_disque_geli_zfs_sdd_l2arc_zil/" title="Add Hard Drive with cache on SSD" class="md-nav__link">
      Add Hard Drive with cache on SSD
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Install graylog server
      </label>
    
    <a href="./" title="Install graylog server" class="md-nav__link md-nav__link--active">
      Install graylog server
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" title="Intro" class="md-nav__link">
    Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-lxc-container-on-lxc-host-04" title="Create lxc container on lxc-host-04" class="md-nav__link">
    Create lxc container on lxc-host-04
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation" title="Creation" class="md-nav__link">
    Creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reinstall-it-to-condfigure-capping" title="Reinstall it to condfigure capping" class="md-nav__link">
    Reinstall it to condfigure capping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-zabbix-agent" title="Install zabbix agent" class="md-nav__link">
    Install zabbix agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backports-and-some-pkgs" title="Backports and some pkgs" class="md-nav__link">
    Backports and some pkgs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graylog-installation" title="Graylog Installation" class="md-nav__link">
    Graylog Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mongodb" title="MongoDB" class="md-nav__link">
    MongoDB
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch" title="Elasticsearch" class="md-nav__link">
    Elasticsearch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install_1" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-elasticsearch" title="Launch elasticsearch" class="md-nav__link">
    Launch elasticsearch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graylog" title="Graylog" class="md-nav__link">
    Graylog
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install_2" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration_1" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-graylog" title="Launch graylog" class="md-nav__link">
    Launch graylog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache" title="Apache" class="md-nav__link">
    Apache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-to-web-interface" title="Connect to web interface" class="md-nav__link">
    Connect to web interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsyslog-client-configuration" title="Rsyslog client configuration" class="md-nav__link">
    Rsyslog client configuration
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Articles
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Articles
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../articles/article/" title="Create a server" class="md-nav__link">
      Create a server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../articles/article2/" title="Delete a server" class="md-nav__link">
      Delete a server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Divers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Divers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../blog/blog/" title="Autre info" class="md-nav__link">
      Autre info
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Blog
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Blog
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../blog/blog/" title="Billet du jour" class="md-nav__link">
      Billet du jour
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" title="Intro" class="md-nav__link">
    Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#installation" title="Installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-lxc-container-on-lxc-host-04" title="Create lxc container on lxc-host-04" class="md-nav__link">
    Create lxc container on lxc-host-04
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation" title="Creation" class="md-nav__link">
    Creation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reinstall-it-to-condfigure-capping" title="Reinstall it to condfigure capping" class="md-nav__link">
    Reinstall it to condfigure capping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-zabbix-agent" title="Install zabbix agent" class="md-nav__link">
    Install zabbix agent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#backports-and-some-pkgs" title="Backports and some pkgs" class="md-nav__link">
    Backports and some pkgs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graylog-installation" title="Graylog Installation" class="md-nav__link">
    Graylog Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mongodb" title="MongoDB" class="md-nav__link">
    MongoDB
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elasticsearch" title="Elasticsearch" class="md-nav__link">
    Elasticsearch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install_1" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-elasticsearch" title="Launch elasticsearch" class="md-nav__link">
    Launch elasticsearch
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#graylog" title="Graylog" class="md-nav__link">
    Graylog
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install_2" title="Install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration_1" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#launch-graylog" title="Launch graylog" class="md-nav__link">
    Launch graylog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache" title="Apache" class="md-nav__link">
    Apache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-to-web-interface" title="Connect to web interface" class="md-nav__link">
    Connect to web interface
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rsyslog-client-configuration" title="Rsyslog client configuration" class="md-nav__link">
    Rsyslog client configuration
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="install-graylog-server-for-lab-testing">Install GrayLog server for lab testing<a class="headerlink" href="#install-graylog-server-for-lab-testing" title="Permanent link">&para;</a></h1>
<h2 id="intro">Intro<a class="headerlink" href="#intro" title="Permanent link">&para;</a></h2>
<p>This is an installation guide of Graylog for Lab env.
Do not use this documentation for production use !</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<h3 id="create-lxc-container-on-lxc-host-04">Create lxc container on lxc-host-04<a class="headerlink" href="#create-lxc-container-on-lxc-host-04" title="Permanent link">&para;</a></h3>
<h4 id="creation">Creation<a class="headerlink" href="#creation" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>ssh salt.int.cozycloud.cc
cd ~/dev/nico/proxmox-deploy
./deploy-lxc-on-host.sh lxc-host-04.cozycloud.cc graylog-00-dev 10.255.100.52 salt-dev
</pre></div>


<h4 id="reinstall-it-to-condfigure-capping">Reinstall it to condfigure capping<a class="headerlink" href="#reinstall-it-to-condfigure-capping" title="Permanent link">&para;</a></h4>
<p>By default, script on salt server doesn't configurer lxc capping.
Connect to lxc-host-04, backup ssh and salt conf of the graylog container, destroy the container, reinstall it with capping, restore ssh and salt conf.</p>
<div class="codehilite"><pre><span></span>ssh lxc-host-04.int.cozycloud.cc
lxc-stop -n graylog-00-dev
mount /dev/lxc/graylog-00-dev /var/lib/lxc/graylog-00-dev/rootfs/
tar zcfp graylog-00-dev.tgz /var/lib/lxc/graylog-00-dev/rootfs/etc/{salt,ssh}
umount /var/lib/lxc/graylog-00-dev/rootfs/
lxc-destroy -n graylog-00-dev 
create-lxc-guest -T -p -m 16G -w 8G -s 200G -n graylog-00-dev -d int.cozycloud.cc -P apt.int.cozycloud.cc -i 10.255.100.52 -S salt-dev.int.cozycloud.cc -M graylog-00-dev.int.cozycloud.cc
mount /dev/lxc/graylog-00-dev /var/lib/lxc/graylog-00-dev/rootfs/
cd /
tar -zxf ~/graylog-00-dev.tgz
umount /var/lib/lxc/graylog-00-dev/rootfs/
lxc-start -n graylog-00-dev
</pre></div>


<h4 id="install-zabbix-agent">Install zabbix agent<a class="headerlink" href="#install-zabbix-agent" title="Permanent link">&para;</a></h4>
<p>For this lab, we'll need to have informations about how much graylog and ELK will consume.</p>
<div class="codehilite"><pre><span></span>ssh salt-dev.int.cozycloud.cc
cd /srv/pillar/hosts/int_cozycloud.cc
vi graylog-00-dev.sls

root@salt-dev:/srv/pillar/hosts/int_cozycloud_cc# cat graylog-00-dev.sls 
roles:
  - zabbix.agent

git add graylog-00-dev.sls
salt --state-output=changes &#39;graylog-00*&#39; state.highstate
</pre></div>


<h4 id="backports-and-some-pkgs">Backports and some pkgs<a class="headerlink" href="#backports-and-some-pkgs" title="Permanent link">&para;</a></h4>
<p>We'll need backports to deploy all softwares</p>
<div class="codehilite"><pre><span></span>ssh graylog-00-dev.int.cozycoud.cc
echo &quot;deb http://ftp.debian.org/debian jessie-backports main&quot; &gt; /etc/apt/sources.list.d/backports.list
apt-get update
apt-get upgrade
apt install -y ca-certificates-java apt-transport-https uuid-runtime pwgen wget
apt-get install -t jessie-backports openjdk-8-jdk
update-java-alternatives --set java-1.8.0-openjdk-amd64
</pre></div>


<h3 id="graylog-installation">Graylog Installation<a class="headerlink" href="#graylog-installation" title="Permanent link">&para;</a></h3>
<p>First, we need to install and configure mongodb serveur and ElasticSearch.
For this dev env, we'll not install them in cluster mode.</p>
<h4 id="mongodb">MongoDB<a class="headerlink" href="#mongodb" title="Permanent link">&para;</a></h4>
<h5 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>ssh graylog-00-dev.int.cozycoud.cc
apt-get install -y mongodb-server
</pre></div>


<h4 id="elasticsearch">Elasticsearch<a class="headerlink" href="#elasticsearch" title="Permanent link">&para;</a></h4>
<h5 id="install_1">Install<a class="headerlink" href="#install_1" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>ssh graylog-00-dev.int.cozycoud.cc
wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | apt-key add -
echo &quot;deb https://artifacts.elastic.co/packages/5.x/apt stable main&quot; | tee -a /etc/apt/sources.list.d/elastic-5.x.list
apt update &amp;&amp; apt install elasticsearch
</pre></div>


<h5 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h5>
<p>Make sure to modify the Elasticsearch configuration file (/etc/elasticsearch/elasticsearch.yml) and set the cluster name to graylog additionally you need to uncomment (remove the # as first character) the line:</p>
<div class="codehilite"><pre><span></span>cluster.name: graylog
</pre></div>


<p>By default, ElasticSearch is configured to use 2G of Ram. We'll add 6 Go.</p>
<div class="codehilite"><pre><span></span>vi /etc/elasticsearch/jvm.options
-Xms8g
-Xmx8g
</pre></div>


<h5 id="launch-elasticsearch">Launch elasticsearch<a class="headerlink" href="#launch-elasticsearch" title="Permanent link">&para;</a></h5>
<p>After you have modified the configuration, you can start Elasticsearch:</p>
<div class="codehilite"><pre><span></span>systemctl daemon-reload
systemctl enable elasticsearch.service
systemctl restart elasticsearch.service
</pre></div>


<h4 id="graylog">Graylog<a class="headerlink" href="#graylog" title="Permanent link">&para;</a></h4>
<h5 id="install_2">Install<a class="headerlink" href="#install_2" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>ssh graylog-00-dev.int.cozycoud.cc
wget https://packages.graylog2.org/repo/packages/graylog-2.3-repository_latest.deb
dpkg -i graylog-2.3-repository_latest.deb
apt update &amp;&amp; apt install graylog-server
</pre></div>


<h5 id="configuration_1">Configuration<a class="headerlink" href="#configuration_1" title="Permanent link">&para;</a></h5>
<p>We'll need to edit /etc/graylog/server/server.conf
But before, generate two passwords with:</p>
<div class="codehilite"><pre><span></span>pwgen -N 1 -s 96
Cj6kY5vzNtog1sEyhT1ezRBGardpLWMggSsQLS9gdATUwCQORkQrgsaGMRmzJHaquuPx8dlDD9UTQP7cmjMINjdqQ8bNMDQq
and

echo -n cozy42! | sha256sum
e83651034b3887b31ec01d714cff32585784589b5e544b4b58d15e0f97dec87e

vi /etc/graylog/server/server.conf

password_secret = Cj6kY5vzNtog1sEyhT1ezRBGardpLWMggSsQLS9gdATUwCQORkQrgsaGMRmzJHaquuPx8dlDD9UTQP7cmjMINjdqQ8bNMDQq
root_password_sha2 = e83651034b3887b31ec01d714cff32585784589b5e544b4b58d15e0f97dec87e
rest_listen_uri = http://0.0.0.0:9110/api/
rest_transport_uri = http://10.255.100.52:9110/api/
rest_enable_cors = true
web_enable = true
web_listen_uri = http://127.0.0.1:9000/
web_enable_cors = true
</pre></div>


<h5 id="launch-graylog">Launch graylog<a class="headerlink" href="#launch-graylog" title="Permanent link">&para;</a></h5>
<div class="codehilite"><pre><span></span>systemctl daemon-reload
systemctl enable graylog-server.service
systemctl start graylog-server.service
</pre></div>


<h4 id="apache">Apache<a class="headerlink" href="#apache" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>apt install -y apache2
cd /etc/apache2/mods-enabled
ln -s ../mods-available/proxy.conf ./
ln -s ../mods-available/proxy.load ./
ln -s ../mods-available/headers.load ./
ln -s ../mods-available/proxy_http.load ./

cd /etc/apache2/sites-enabled
vi 000-default.conf
&lt;VirtualHost *:8080&gt;
    ServerAdmin root@localhost
        ServerName graylog-00-dev.int.cozycloud.cc
        ProxyRequests off
    &lt;Proxy *&gt;
                Order deny,allow
                Deny from all
                allow from all
        &lt;/Proxy&gt;
        ProxyPreserveHost on
        ProxyPass /api/ http://127.0.0.1:9110/api/
        ProxyPassReverse /api/ http://127.0.0.1:9110/api/

        RequestHeader set X-Graylog-Server-URL &quot;http://localhost:8080/api/&quot;
        ProxyPass / http://127.0.0.1:9000/ nocanon
        ProxyPassReverse  /  http://127.0.0.1:9000/
        AllowEncodedSlashes NoDecode
&lt;/VirtualHost&gt;
</pre></div>


<h4 id="connect-to-web-interface">Connect to web interface<a class="headerlink" href="#connect-to-web-interface" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span>ssh -L 9000:10.255.100.52:9000 graylog-00-dev.int.cozycloud.cc
</pre></div>


<h2 id="rsyslog-client-configuration">Rsyslog client configuration<a class="headerlink" href="#rsyslog-client-configuration" title="Permanent link">&para;</a></h2>
<p>vi /etc/rsyslog.d/client.conf</p>
<div class="codehilite"><pre><span></span>*.* @@graylog-00-dev.int.cozycloud.cc:1520;RSYSLOG_SyslogProtocol23Format
</pre></div>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ajout_disque_geli_zfs_sdd_l2arc_zil/" title="Add Hard Drive with cache on SSD" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Add Hard Drive with cache on SSD
              </span>
            </div>
          </a>
        
        
          <a href="../../articles/article/" title="Create a server" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Create a server
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Frederic Alix
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/admdwrf" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/fredericalix" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/in/fredericalix/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-6940329b9f.js"></script>
      
      
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>